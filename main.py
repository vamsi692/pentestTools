import os
import webbrowser
from forcedBrowsing import *

class penTools:
    _browser_path="/usr/lib/firefox-esr/firefox-bin"
    def __init__(self, snowID, URL, wordlist_path):
        self.wordlist_path = wordlist_path
        self.snowID = snowID
        self.URL = URL

    def main(self):
        self.nmap()
        self.dirb()
        self.forceBrowse()
        self.response()
        self.hygiene_issues()
        print("Done")

    @staticmethod
    def setBrowserPath(browserPath):
        penTools._browser_path=browserPath
    # def basics(self):
    #     self.browser_path = input("please specify the browser path, usually for linux it is /usr/lib/firefox-esr/firefox-bin :")

    def setURL_ListPath(self,path):
        self.URLlist_path=path

    def nmap(self):
        URL1=self.URL.split("://")[1]
        cmd = "sudo nmap -oG "+self.snowID+"_nmap.txt -sS " + URL1
        os.system(cmd)

    def dirb(self):
        cmd = "sudo dirb "+ self.URL + " " + self.wordlist_path + "-o" + self.snowID + "_dirb.txt"
        os.system(cmd)

    def forceBrowse(self):
        if hasattr(self,'URLlist_path'):
            forcedBrowsing(self.URLlist_path, self._browser_path)

    def response(self):
        cmd = "curl -s -I -X POST "+URL+" >"+self.snowID+"_HTTP_Response_Headers.txt"
        os.system(cmd)

    def hygiene_issues(self):
        response=open(self.snowID+"_HTTP_Response_Headers.txt")
        response_headers = response.readlines()[1:]
        headers = {}
        for header in response_headers:
            try:
                [key, value] = header[:-1].split(':', 1)
                headers[key.upper()] = value
            except:
                continue


snowID=""
URL=""
URLlist=None
wordlist=""
snowID=input("please enter snowID* : ")
URL = input("please enter the URL of the application* : ")
wordlist_path = input("please enter the location of the list of wordlist (you can leave this field blank if you want a default scan) : ")
# browser_path = input("please specify the browser path, usually for linux it is /usr/lib/firefox-esr/firefox-bin :")

# print(pt.snowID + "," + pt.URL + "," + pt.URLlist + "," + pt.wordlist)
# print(URL.split("://")[1])
if(input("Do you want to go with the default browser path for Linux?\n Enter Y/n : ").upper()=='N'):
    browser_path = input("please specify the browser path : ")
    while(browser_path==""):
        browser_path = input("please enter valid browser path : ")
    penTools.setBrowserPath(browser_path)

pt=penTools(snowID, URL, wordlist_path)

if(input("Do you have path for the list of URLs in the host.\n Enter Y/n :").upper()=='Y'):
    URLlist_path = input("please enter the location of the list of URLs (you can leave this field blank if you want a default scan) : ")
    while(URLlist_path==""):
        URLlist_path=input("Please enter valid URL path : ")
    pt.setURL_ListPath(URLlist_path)

pt.main()
